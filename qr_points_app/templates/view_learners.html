<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <title>View Learners - {{ group.code }}</title>
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css" rel="stylesheet"/>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.1/css/all.min.css" rel="stylesheet"/>
    <link rel="stylesheet" type="text/css" href="static/leaderboard_styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500&display=swap" rel="stylesheet">

</head>
<body class="bg-light">
<div class="container mt-5">
    <h1 class="mb-4">Learners in {{ group.code }}</h1>
    <!-- List of Users in the Group -->
    <div class="card mb-4">
        <div class="card-body">
            <h3 class="card-title">Class List</h3>
            <table class="table table-striped table-hover table-responsive table-bordered">
                <thead class="thead-dark">
                    <tr>
                        <th scope="col">#</th>
                        <th scope="col">Name</th>
                        <th scope="col">Points</th>
                        <th scope="col">Actions</th>
                    </tr>
                </thead>
                {% for user in users %}
                <tbody id="leaderboard-tbody">
                    <tr class="table-row" data-user-id="{{ user.id }}">
                        <td class="table-cell" class_="number">N/A</td>
                        <td class="table-cell" class_="name">{{ user.first_name + ' ' + user.last_name }}</td>
                        <td class="table-cell" class_="points">{{ user.points }}</td>
                        <td class="table-cell" class_="actions">
                            <form action="{{ url_for('admin.add_point', user_id=user.id) }}" class="d-inline" method="post">
                                <button class="btn btn-success btn-sm" type="submit"><i class="fas fa-plus"></i></button>
                            </form>
                            <form action="{{ url_for('admin.subtract_point', user_id=user.id) }}" class="d-inline ml-2" method="post">
                                <button class="btn btn-danger btn-sm" type="submit"><i class="fas fa-minus"></i></button>
                            </form>
                        </td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    <a class="btn btn-warning mt-4" href="{{ url_for('admin.admin_dashboard') }}">Back to Dashboard</a>
</div>
<script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/4.0.1/socket.io.js"></script>
<script>
        // Connect to Socket.IO
        var socket = io.connect(location.protocol + '//' + document.domain + ':' + location.port);
        
        // Listen for the 'update_leaderboard' event
        socket.on('user_joined', function(data) {
            console.log('Leaderboard updated: ', data);
        
            // Find the row for the user
            var row = document.querySelector(`[data-user-id="${data.user_id}"]`);
            if(row) {
                // Find the points cell in the row and update the points
                var pointsCell = row.querySelector('.points');
                if(pointsCell) {
                    pointsCell.textContent = data.points;
                    console.log('User Row Updated: true');
                } else {
                    console.log('Points cell not found!');
                }
            } else {
                console.log('User row not found!');
            }
        });
    </script>
<script>
        document.getElementById('selectRandomUser').addEventListener('click', function() {
    var userList = document.querySelectorAll('.list-group-item');
    
    // Check if there are any users to select from
    if(userList.length === 0) {
        alert("No users to select from.");
        return;
    }

    // Remove the highlight class from all users
    userList.forEach(function(user) {
        user.classList.remove('highlight');
    });

    var index = 0;
    var intervalId = setInterval(function() {
        // Remove the highlight class from the previous user
        if(index != 0) {
            userList[(index - 1) % userList.length].classList.remove('highlight');
        } else {
            userList[userList.length - 1].classList.remove('highlight');
        }

        // Add the highlight class to the current user
        userList[index % userList.length].classList.add('highlight');

        // Increment the index for the next iteration
        index++;
    }, 100); // Run every 100 milliseconds

    // Stop after a random time
    var stopAfter = Math.random() * 5000 + 2000; // Between 2 and 7 seconds
    setTimeout(function() {
        clearInterval(intervalId); // Stop the interval
    }, stopAfter);
});

    </script>
<style>
        .list-group-item.highlight {
            background-color: #ff8f1c; /* Gold */
            transition: background-color 0.5s ease;
        }
    </style>
<script>
        // ... existing socket connection and 'update_leaderboard' event listener ...
    
        // Listen for the 'user_joined_group' event
        socket.on('user_joined_group', function(data) {
            console.log('User Joined Group: ', data);
            
            // Create a new list item for the joined user
            var li = document.createElement('li');
            li.className = 'list-group-item d-flex justify-content-between align-items-center';
            li.dataset.userId = data.user_id;
            
            // Populate the list item with user data
            li.innerHTML = `
                <div>${data.user_name}</div>
                <div><span class="points">${data.points}</span> points</div>
                <div>
                    <form action="${data.add_point_url}" method="post" class="d-inline">
                        <button type="submit" class="btn btn-success btn-sm"><i class="fas fa-plus"></i></button>
                    </form>
                    <form action="${data.subtract_point_url}" method="post" class="d-inline ml-2">
                        <button type="submit" class="btn btn-danger btn-sm"><i class="fas fa-minus"></i></button>
                    </form>
                </div>
            `;
            
            // Append the new list item to the user list
            var userList = document.querySelector('.list-group.list-group-flush');
            userList.appendChild(li);
        });
    </script>
</body>
</html>
